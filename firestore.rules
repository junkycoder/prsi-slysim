rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function verified(request) {
      return request.auth != null && request.auth.uid != null && request.auth.email != null;
    }

    match /games/{game} {
      // Only server can access all game fata
      allow read: if false;
      allow list: if false;
      allow create: if false
      allow update: if false;
      allow delete: if false;
    }

    match /users/{user}/games/{game} {
      // User can list and read his game copies
      allow read: if user == request.auth.uid;
      allow list: if user == request.auth.uid;

      // Only backends can create new game
      allow create: if false;

      // This is how user can make his game moves
      allow update: if user == request.auth.uid;

      // Only backend can delete the game
      allow delete: if false;
    }

  }
}